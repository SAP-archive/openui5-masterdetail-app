/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/library","sap/ui/core/dnd/DropInfo","sap/f/dnd/GridDragOver","sap/base/Log"],function(t,r,e,o){"use strict";var n=r.extend("sap.f.dnd.GridDropInfo",{metadata:{library:"sap.f",interfaces:["sap.ui.core.dnd.IDropInfo"],properties:{dropIndicatorSize:{type:"function",invalidate:false,parameters:{draggedControl:{type:"sap.ui.core.Control"}}}},events:{}}});n.prototype.isDroppable=function(t,e){if(!this._shouldEnhance()){return r.prototype.isDroppable.apply(this,arguments)}if(!this.getEnabled()){return false}if(!t||!e){return false}var o=this.getDropTarget();if(!o){return false}var n=o.getDomRefForSetting(this.getTargetAggregation());if(n&&n.contains(e.target)){e.setMark("DragWithin",this.getTargetAggregation());return true}if(!n&&o===t){return true}return false};n.prototype.fireDragEnter=function(t){if(!this._shouldEnhance()||this._isKeyboardEvent(t)){return r.prototype.fireDragEnter.apply(this,arguments)}if(!t||!t.dragSession||!t.dragSession.getDragControl()){return null}this._hideDefaultIndicator(t);var o=e.getInstance(),n=t.dragSession.getDragControl();if(this.getDropIndicatorSize()){o.setDropIndicatorSize(this.getDropIndicatorSize()(n))}o.setCurrentContext(t.dragSession.getDragControl(),this.getDropTarget(),this.getTargetAggregation());var i=o.getSuggestedDropPosition();var a=this.fireEvent("dragEnter",{dragSession:t.dragSession,browserEvent:t.originalEvent,target:i?i.targetControl:null},true);if(a){o.handleDragOver(t)}return a};n.prototype.fireDragOver=function(t){if(!this._shouldEnhance()||this._isKeyboardEvent(t)){return r.prototype.fireDragOver.apply(this,arguments)}if(!t||!t.dragSession||!t.dragSession.getDragControl()){return null}this._hideDefaultIndicator(t);var e=this._suggestDropPosition(t);if(e&&t.dragSession&&e.targetControl){t.dragSession.setDropControl(e.targetControl)}return this.fireEvent("dragOver",{dragSession:t.dragSession,browserEvent:t.originalEvent,target:e?e.targetControl:null,dropPosition:e?e.position:null})};n.prototype.fireDrop=function(t){if(!this._shouldEnhance()||this._isKeyboardEvent(t)){return r.prototype.fireDrop.apply(this,arguments)}if(!t||!t.dragSession||!t.dragSession.getDragControl()){return null}var o=t.dragSession,n=e.getInstance(),i;n.setCurrentContext(o.getDragControl(),this.getDropTarget(),this.getTargetAggregation());i=n.getSuggestedDropPosition();this.fireEvent("drop",{dragSession:t.dragSession,browserEvent:t.originalEvent,dropPosition:i?i.position:null,draggedControl:o.getDragControl(),droppedControl:i?i.targetControl:null});n.scheduleEndDrag()};n.prototype._shouldEnhance=function(){if(this._bShouldEnhance===undefined){if(!this.getParent().isA("sap.f.dnd.IGridDroppable")){o.error("The control which uses 'sap.f.dnd.GridDropInfo' has to implement 'sap.f.dnd.IGridDroppable'.","sap.f.dnd.GridDropInfo");this._bShouldEnhance=false;return this._bShouldEnhance}this._bShouldEnhance=this.getDropPosition()===t.dnd.DropPosition.Between&&this.getDropLayout()===t.dnd.DropLayout.Horizontal}return this._bShouldEnhance};n.prototype._isKeyboardEvent=function(t){return t.originalEvent.type==="keydown"};n.prototype._suggestDropPosition=function(t){if(!t.dragSession||!t.dragSession.getDragControl()){return null}var r=e.getInstance();r.setCurrentContext(t.dragSession.getDragControl(),this.getDropTarget(),this.getTargetAggregation());r.handleDragOver(t);return r.getSuggestedDropPosition()};n.prototype._hideDefaultIndicator=function(t){t.dragSession.setIndicatorConfig({visibility:"hidden",position:"relative"})};return n});