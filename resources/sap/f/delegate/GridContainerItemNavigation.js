/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/delegate/ItemNavigation","./GridItemNavigation"],function(t,e){"use strict";function o(t){if(t.onfocusin){t.onfocusin()}}var s=e.extend("sap.f.delegate.GridContainerItemNavigation",{constructor:function(){e.apply(this,arguments);this.attachEvent(t.Events.FocusLeave,this._onFocusLeave,this)},metadata:{library:"sap.f",properties:{},events:{}}});s.prototype._onFocusLeave=function(t){var e=this.getFocusedDomRef();this.getItemDomRefs().forEach(function(t,o){if(e===t){var s=o++;this.setFocusedIndex(s)}}.bind(this));this._bFocusLeft=true};s.prototype.forwardTab=function(t){var e=this._getRootDomRefId()+"-"+(t?"after":"before");document.getElementById(e).focus()};s.prototype._getRootDomRefId=function(t){return this.getRootDomRef().getAttribute("id")};s.prototype.onsaptabnext=function(t){var e=this.getItemDomRefs(),o=this.getFocusedIndex(),s=jQuery(e[o]),i=[];var n=s.find(":sapTabbable");n.map(function(t,e){if(e.className.indexOf("DummyArea")===-1){i.push(e)}});var a=jQuery(i),r=a.length===1?0:a.length-1;if(r===-1||a.control(r)&&a.control(r).getId()===t.target.id){this._lastFocusedElement=t.target;this.forwardTab(true)}};s.prototype.onsaptabprevious=function(t){if(!t.target.classList.contains("sapFGridContainerItemWrapper")){this._lastFocusedElement=t.target;return}var e=t.target.id;if(e===this._getRootDomRefId()+"-nodata"){this.forwardTab(false)}this._lastFocusedElement=null;this.forwardTab(false)};s.prototype.onmousedown=function(e){this._bIsMouseDown=true;t.prototype.onmousedown.call(this,e)};s.prototype.onmouseup=function(t){var e=jQuery(t.target).closest(".sapFGridContainerItemWrapperNoVisualFocus"),s;if(e.length){s=e.children().eq(0).control()[0];if(s&&s.getFocusDomRef()===document.activeElement){this._lastFocusedElement=null;e.trigger("focus");o(s)}}this._bIsMouseDown=false};s.prototype.onfocusin=function(e){t.prototype.onfocusin.call(this,e);var s=jQuery(e.target).closest(".sapFGridContainerItemWrapperNoVisualFocus"),i,n,a;if(s.length){i=s.children().eq(0).control()[0];if(i){o(i);if(!this._bIsMouseDown&&i.getFocusDomRef()===e.target){this._lastFocusedElement=null;s.trigger("focus");return}}}if(e.target.classList.contains("sapFGridContainerItemWrapper")){this._lastFocusedElement=null}if(this._bFocusLeft){this._bFocusLeft=false;n=this.getItemDomRefs();a=this.getFocusedIndex();if(this._lastFocusedElement){this._lastFocusedElement.focus()}else{n[a].focus()}}};s.prototype.focusItem=function(e,o){if(e===this.iFocusedIndex&&this.aItemDomRefs[this.iFocusedIndex]===document.activeElement){this.fireEvent(t.Events.FocusAgain,{index:e,event:o});return}this.fireEvent(t.Events.BeforeFocus,{index:e,event:o});this.setFocusedIndex(e);this.bISetFocus=true;if(o&&jQuery(this.aItemDomRefs[this.iFocusedIndex]).data("sap.INRoot")){var s=jQuery(this.aItemDomRefs[this.iFocusedIndex]).data("sap.INRoot");s._sFocusEvent=o.type}if(!this._bIsMouseDown&&this.aItemDomRefs.length){this.aItemDomRefs[this.iFocusedIndex].focus()}this.fireEvent(t.Events.AfterFocus,{index:e,event:o})};return s});