/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/model/json/JSONModel","sap/m/FlexBox","sap/viz/ui5/controls/VizFrame","sap/viz/ui5/controls/common/feeds/FeedItem","sap/viz/ui5/data/FlattenedDataset","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/f/cards/Data"],function(t,e,a,i,s,n,o,r,d){"use strict";var u=t.extend("sap.f.cards.content.Analytical",{metadata:{properties:{chart:{type:"object"}},aggregations:{_content:{multiple:false,visibility:"hidden"}}},renderer:function(t,e){t.renderControl(e.getAggregation("_content"))}});u.prototype.init=function(){var t=new e;this.setModel(t)};u.prototype.exit=function(){if(this._oChart){this._oChart.destroy();this._oChart=null}if(this.oFlattendedDataset){this.oFlattendedDataset.destroy();this.oFlattendedDataset=null}};u.prototype.setChart=function(t){this.setProperty("chart",t,true);if(!t){return this}var e=t.data.request;if(t.json&&!e){this._updateModel(t.json,t.path)}if(e){d.fetch(e).then(function(e){this._updateModel(e,t.data.path,t)}.bind(this)).catch(function(t){})}return this};u.prototype._updateModel=function(t,e,a){var o=a.type;this.getModel().setData(t);var r=[];if(a.dimensions){var d=[];for(var u=0;u<a.dimensions.length;u++){var l=a.dimensions[u];var h=l.value.substring(1,l.value.length-1);r.push(h);var p={name:h,value:l.value};d.push(p)}}var v=[];if(a.measures){var f=[];for(var u=0;u<a.measures.length;u++){var c=a.measures[u];var h=c.value.substring(1,c.value.length-1);v.push(h);var m={name:h,value:c.value};f.push(m)}}this.oFlattendedDataset=new n({measures:f,dimensions:d,data:{path:a.data.path}});this._oChart=new i({uiConfig:{applicationSet:"fiori"},vizType:o,dataset:this.oFlattendedDataset,legendVisible:a.legend,feeds:[new s({uid:a.measureUid,type:"Measure",values:v}),new s({uid:a.dimensionUid,type:"Dimension",values:r})]});this._oChart.setVizProperties(a.vizProperties);this.setAggregation("_content",this._oChart)};return u});